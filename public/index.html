<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>뚜기의 부산 맛집</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="user-menu.css">
    <link rel="stylesheet" href="language-selector.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- 네이버 지도 API는 동적으로 로드됩니다 -->
</head>
<body>
    <!-- Side Menu Overlay -->
    <div class="side-menu-overlay" id="sideMenuOverlay" onclick="closeSideMenu()"></div>
    
    <!-- Simplified Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <div class="side-menu-profile">
                <div class="side-menu-avatar">🐧</div>
                <div class="side-menu-info">
                    <h3 data-translate="profile.name">뚜기 AI</h3>
                    <p data-translate="profile.status">맛집 가이드</p>
                </div>
            </div>
            <button class="side-menu-close" onclick="closeSideMenu()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="side-menu-content">
            <!-- 통합된 사이드 메뉴 -->
            <nav class="side-menu-nav">
                <!-- 새 대화 버튼 -->
                <button class="side-menu-item new-chat-item" onclick="startNewConversation()">
                    <i class="fas fa-plus"></i>
                    <span data-translate="menu.newChat">새 대화</span>
                </button>
                
                <!-- 대화 검색 -->
                <div class="conversation-search-item">
                    <div class="chat-search-container">
                        <input type="text" placeholder="대화 검색..." id="conversationSearch" onkeyup="searchConversations()" data-translate="menu.searchConversations">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
                
                <!-- 대화 목록 (동적으로 여기에 추가됩니다) -->
                <div class="conversation-list" id="conversationList">
                    <div class="loading-conversations">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span data-translate="loading.conversations">대화 목록 로딩 중...</span>
                    </div>
                </div>
                
                <hr class="side-menu-divider">
                
                <!-- 메뉴 항목들 -->
                <button class="side-menu-item" id="loginMenuItem" onclick="handleLogin()">
                    <i class="fas fa-user"></i>
                    <span id="loginMenuText" data-translate="login">로그인</span>
                </button>
                <button class="side-menu-item" onclick="navigateToSavedRestaurants()">
                    <i class="fas fa-heart"></i>
                    <span data-translate="menu.savedRestaurants">저장된 맛집</span>
                </button>
            </nav>
        </div>
    </div>

    <div class="instagram-dm-container">
        <!-- Simplified Header -->
        <div class="dm-header">
            <div class="dm-header-left">
                <button class="menu-btn" aria-label="메뉴" onclick="toggleSideMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="profile-info">
                    <div class="profile-avatar">
                        <div class="avatar-image">🐧</div>
                        <div class="online-indicator"></div>
                    </div>
                    <div class="profile-details">
                        <h2 class="profile-name" data-translate="profile.name">뚜기</h2>
                        <p class="profile-status" data-translate="profile.status">맛집 가이드</p>
                    </div>
                </div>
            </div>
            <div class="dm-header-right">
                <button class="header-action-btn user-profile-btn" id="userProfileBtn" aria-label="사용자 프로필" onclick="toggleUserMenu()">
                    <i class="fas fa-user" id="userProfileIcon"></i>
                    <img id="userProfileImage" class="profile-image" style="display: none;" alt="프로필">
                </button>
                <!-- User Dropdown Menu -->
                <div class="user-dropdown-menu" id="userDropdownMenu" style="display: none;">
                    <div class="dropdown-header">
                        <div class="dropdown-user-info" id="dropdownUserInfo">
                            <img id="dropdownUserImage" class="dropdown-user-avatar" alt="프로필">
                            <div class="dropdown-user-details">
                                <div class="dropdown-user-name" id="dropdownUserName" data-translate="guest">게스트</div>
                                <div class="dropdown-user-email" id="dropdownUserEmail"></div>
                            </div>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-menu-items">
                        <button class="dropdown-menu-item" onclick="navigateToSavedRestaurants(); closeUserMenu();">
                            <i class="fas fa-heart"></i>
                            <span data-translate="dropdown.savedRestaurants">저장된 맛집</span>
                        </button>
                        <button class="dropdown-menu-item" onclick="showSettings(); closeUserMenu();">
                            <i class="fas fa-cog"></i>
                            <span data-translate="dropdown.settings">설정</span>
                        </button>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-auth-section">
                        <button class="dropdown-menu-item" id="dropdownLoginMenuItem" onclick="handleDropdownLogin()">
                            <i class="fas fa-sign-in-alt"></i>
                            <span id="dropdownLoginMenuText" data-translate="login">로그인</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat messages area -->
        <div class="dm-chat-area">
            <div class="dm-messages" id="chatMessages">
                <div class="message-group bot-group">
                    <div class="message-avatar">
                        <div class="avatar-image">🐧</div>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble bot-bubble">
                            <p>마! 뚜기다이가! 🐧</p>
                            <p>부산 토박이 맛집 가이드 뚜기입니다!</p>
                            <p>어떤 맛있는 거 찾고 있노? 😊</p>
                        </div>
                        <div class="message-time">방금 전</div>
                    </div>
                </div>
            </div>

            <!-- Quick suggestions -->
            <div class="quick-suggestions" id="quickSuggestions">
                <div class="suggestions-container">
                    <button class="suggestion-pill" onclick="sendQuickMessage('해운대 맛집 추천해줘')">
                        <i class="fas fa-map-marker-alt"></i>
                        <span data-translate="suggestion.haeundae">해운대 맛집</span>
                    </button>
                    <button class="suggestion-pill" onclick="sendQuickMessage('돼지국밥 맛집 알려줘')">
                        <i class="fas fa-bowl-hot"></i>
                        <span data-translate="suggestion.porkSoup">돼지국밥</span>
                    </button>
                    <button class="suggestion-pill" onclick="sendQuickMessage('회 먹을 만한 곳')">
                        <i class="fas fa-fish"></i>
                        <span data-translate="suggestion.sashimi">회 맛집</span>
                    </button>
                    <button class="suggestion-pill" onclick="sendQuickMessage('서면 저렴한 맛집')">
                        <i class="fas fa-won-sign"></i>
                        <span data-translate="suggestion.seomyeon">서면 저렴한 곳</span>
                    </button>
                    <button class="suggestion-pill" onclick="sendQuickMessage('카페 추천해줘')">
                        <i class="fas fa-coffee"></i>
                        <span data-translate="suggestion.cafe">카페 추천</span>
                    </button>
                </div>
            </div>

            <!-- Typing indicator -->
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="message-group bot-group">
                    <div class="message-avatar">
                        <div class="avatar-image">🐧</div>
                    </div>
                    <div class="message-content">
                        <div class="typing-bubble">
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input area -->
        <div class="dm-input-area">
            <div class="input-container">
                <div class="input-wrapper">
                    <div class="language-selector">
                        <button class="language-btn" id="languageBtn" aria-label="언어 선택">
                            <i class="fas fa-globe" id="currentLanguageIcon"></i>
                        </button>
                        <div class="language-dropdown" id="languageDropdown" style="display: none;">
                            <button class="language-option" data-lang="ko">
                                <span class="option-flag">🇰🇷</span>
                                <span class="option-name">한국어</span>
                            </button>
                            <button class="language-option" data-lang="en">
                                <span class="option-flag">🇺🇸</span>
                                <span class="option-name">English</span>
                            </button>
                            <button class="language-option" data-lang="zh">
                                <span class="option-flag">🇨🇳</span>
                                <span class="option-name">中文</span>
                            </button>
                            <button class="language-option" data-lang="ja">
                                <span class="option-flag">🇯🇵</span>
                                <span class="option-name">日本語</span>
                            </button>
                        </div>
                    </div>
                    <div class="text-input-container">
                        <input type="text" id="userInput" placeholder="메시지 보내기..." data-translate="input.placeholder" />
                    </div>
                    <button id="sendButton" class="send-btn" aria-label="보내기">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Simplified Artifacts Modal -->
    <div class="artifacts-overlay" id="artifactsOverlay" style="display: none;">
        <div class="artifacts-container">
            <div class="artifacts-header">
                <div class="artifacts-title">
                    <span id="artifactsLocation" data-translate="artifacts.title">맛집 추천</span>
                </div>
                <button class="artifacts-close" onclick="closeArtifacts()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="artifacts-content">
                <!-- 상단: 맛집 카드 슬라이더 -->
                <div class="artifacts-cards-section">
                    <div class="artifacts-cards-wrapper">
                        <div class="artifacts-cards-slider" id="artifactsCardsSlider">
                            <!-- 맛집 카드들이 동적으로 추가됩니다 -->
                        </div>
                    </div>
                    <div class="artifacts-slider-dots" id="artifactsSliderDots">
                        <!-- 슬라이더 점들이 동적으로 추가됩니다 -->
                    </div>
                </div>
                
                <!-- 하단: 지도 -->
                <div class="artifacts-map-section">
                    <div class="artifacts-map" id="artifactsMap">
                        <div class="map-placeholder">
                            <i class="fas fa-map-marked-alt"></i>
                            <p data-translate="map.placeholder">맛집 위치</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 로그아웃 확인 모달 -->
    <div class="logout-modal-overlay" id="logoutModalOverlay" style="display: none;">
        <div class="logout-modal">
            <div class="logout-modal-header">
                <h3 data-translate="logout.title">로그아웃 확인</h3>
                <button class="logout-modal-close" onclick="hideLogoutModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="logout-modal-content">
                <div class="logout-user-info" id="logoutUserInfo">
                    <img id="logoutUserImage" class="logout-user-avatar" alt="프로필">
                    <div class="logout-user-details">
                        <div class="logout-user-name" id="logoutUserName"></div>
                        <div class="logout-user-email" id="logoutUserEmail"></div>
                    </div>
                </div>
                <p data-translate="logout.question">정말 로그아웃 하시겠습니까?</p>
                <p class="logout-warning" data-translate="logout.warning">저장된 대화는 계정에 연결되어 있어 다시 로그인하면 복구됩니다.</p>
            </div>
            <div class="logout-modal-actions">
                <button class="logout-btn-cancel" onclick="hideLogoutModal()" data-translate="logout.cancel">
                    취소
                </button>
                <button class="logout-btn-confirm" onclick="confirmLogout()" data-translate="logout.confirm">
                    로그아웃
                </button>
            </div>
        </div>
    </div>

    <!-- 대화 삭제 확인 모달 -->
    <div id="deleteConversationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; max-width: 300px; margin: 20px;">
            <h3 style="margin: 0 0 15px 0; color: #212529;" data-translate="delete.title">대화 삭제</h3>
            <p id="deleteConversationText" style="margin: 0 0 20px 0; color: #495057;"></p>
            <div style="display: flex; gap: 10px;">
                <button onclick="window.hideDeleteModal ? window.hideDeleteModal() : console.error('hideDeleteModal 함수 없음')" style="flex: 1; padding: 10px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;" data-translate="delete.cancel">취소</button>
                <button onclick="window.confirmDeleteConversation ? window.confirmDeleteConversation() : console.error('confirmDeleteConversation 함수 없음')" style="flex: 1; padding: 10px; border: none; background: #dc3545; color: white; border-radius: 6px; cursor: pointer;" data-translate="delete.confirm">삭제</button>
            </div>
        </div>
    </div>

    <!-- 플로팅 여행계획서 버튼 -->
    <button id="floatingItineraryBtn" class="floating-itinerary-btn">
        <i class="fas fa-magic"></i>
        <span class="tooltip">여행계획서 만들기</span>
    </button>

    <script src="api-client.js"></script>
    <script src="translations.js"></script>
    <script src="language-functions.js"></script>
    <script src="script.js"></script>
</body>
</html>
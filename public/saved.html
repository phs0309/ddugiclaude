<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì €ì¥ëœ ë§›ì§‘ - ëšœê¸°</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="api-client.js"></script>
    <style>
        .saved-container {
            min-height: 100vh;
            background: #F5F5F5;
            padding: 20px;
            padding-top: 80px;
        }
        
        .saved-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #FFFFFF;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #2F2F2F;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            margin-right: 16px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: #2F2F2F;
            flex: 1;
        }
        
        .saved-count {
            background: #FF6B35;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .saved-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 16px;
            margin-top: 40px;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            color: #2F2F2F;
            margin-bottom: 8px;
        }
        
        .empty-desc {
            color: #8E8E8E;
            margin-bottom: 24px;
        }
        
        .explore-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #FF6B35 0%, #FFD166 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .explore-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
        }
        
        .saved-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .saved-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .saved-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }
        
        .saved-card-header {
            height: 120px;
            background: linear-gradient(135deg, #FF6B35 0%, #FFD166 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
        }
        
        .remove-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .remove-btn:hover {
            background: #FF4757;
            color: white;
            transform: scale(1.1);
        }
        
        .saved-card-body {
            padding: 20px;
        }
        
        .saved-card-name {
            font-size: 18px;
            font-weight: 700;
            color: #2F2F2F;
            margin-bottom: 8px;
        }
        
        .saved-card-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8E8E8E;
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        .saved-card-desc {
            color: #5F5F5F;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .saved-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #E5E5E5;
        }
        
        .saved-date {
            color: #8E8E8E;
            font-size: 12px;
        }
        
        .view-detail-btn {
            color: #FF6B35;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner i {
            font-size: 32px;
            color: #FF6B35;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .saved-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="saved-header">
        <button class="back-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 class="header-title">ì €ì¥ëœ ë§›ì§‘</h1>
        <div class="saved-count" id="savedCount">0</div>
    </div>
    
    <div class="saved-container">
        <div class="saved-content" id="savedContent">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>ì €ì¥ëœ ë§›ì§‘ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>
    
    <script>
        let savedRestaurants = [];
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async () => {
            // ë¡œê·¸ì¸ í™•ì¸
            if (!apiClient.isLoggedIn()) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            // ì €ì¥ëœ ë§›ì§‘ ë°ì´í„° ë¡œë“œ
            await loadSavedRestaurants();
        });
        
        // ì €ì¥ëœ ë§›ì§‘ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSavedRestaurants() {
            try {
                const savedData = await apiClient.getSavedRestaurants();
                const savedIds = savedData.restaurantIds || [];
                
                document.getElementById('savedCount').textContent = savedIds.length;
                
                if (savedIds.length === 0) {
                    showEmptyState();
                } else {
                    // restaurants.jsonì—ì„œ ì‹¤ì œ ë§›ì§‘ ë°ì´í„° ë¡œë“œ
                    await loadRestaurantDetails(savedIds);
                    displaySavedRestaurants();
                }
            } catch (error) {
                console.error('ì €ì¥ëœ ë§›ì§‘ ë¡œë“œ ì‹¤íŒ¨:', error);
                showEmptyState();
            }
        }
        
        // restaurants.jsonì—ì„œ ì‹¤ì œ ë§›ì§‘ ë°ì´í„° ë¡œë“œ
        async function loadRestaurantDetails(savedIds) {
            try {
                // restaurants.json íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/restaurants.json');
                if (!response.ok) {
                    throw new Error('restaurants.json ë¡œë“œ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                const allRestaurants = data.restaurants;
                
                console.log('ğŸ“‹ ì €ì¥ëœ IDë“¤:', savedIds);
                console.log('ğŸ“‹ restaurants.json ì²« 5ê°œ IDë“¤:', allRestaurants.slice(0, 5).map(r => r.id));
                
                // ì €ì¥ëœ IDì— í•´ë‹¹í•˜ëŠ” ë§›ì§‘ë“¤ë§Œ í•„í„°ë§
                savedRestaurants = savedIds.map(savedId => {
                    const restaurant = allRestaurants.find(r => r.id === savedId);
                    if (restaurant) {
                        return {
                            ...restaurant,
                            savedAt: new Date().toISOString() // ì €ì¥ ë‚ ì§œëŠ” í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
                        };
                    } else {
                        // ë§›ì§‘ì„ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
                        console.warn(`âŒ ë§›ì§‘ ID ${savedId}ë¥¼ restaurants.jsonì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                        console.warn(`ì „ì²´ ${allRestaurants.length}ê°œ ë§›ì§‘ ì¤‘ì—ì„œ ê²€ìƒ‰í•¨`);
                        
                        // ë¹„ìŠ·í•œ IDê°€ ìˆëŠ”ì§€ í™•ì¸
                        const similarIds = allRestaurants
                            .filter(r => r.id.includes(savedId) || savedId.includes(r.id))
                            .map(r => r.id)
                            .slice(0, 3);
                        
                        if (similarIds.length > 0) {
                            console.warn(`ğŸ” ë¹„ìŠ·í•œ IDë“¤: ${similarIds.join(', ')}`);
                        }
                        
                        return {
                            id: savedId,
                            name: `ì•Œ ìˆ˜ ì—†ëŠ” ë§›ì§‘ (${savedId})`,
                            area: 'ì•Œ ìˆ˜ ì—†ìŒ',
                            category: 'ê¸°íƒ€',
                            description: 'ë§›ì§‘ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                            savedAt: new Date().toISOString()
                        };
                    }
                }).filter(Boolean); // null/undefined ì œê±°
                
                console.log(`ğŸ“ ${savedIds.length}ê°œ ì¤‘ ${savedRestaurants.length}ê°œ ë§›ì§‘ ë°ì´í„° ë¡œë“œ ì™„ë£Œ`);
                
            } catch (error) {
                console.error('ë§›ì§‘ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                savedRestaurants = savedIds.map(id => ({
                    id: id,
                    name: `ë§›ì§‘ ${id}`,
                    area: 'ì•Œ ìˆ˜ ì—†ìŒ',
                    category: 'ê¸°íƒ€',
                    description: 'ë§›ì§‘ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                    savedAt: new Date().toISOString()
                }));
            }
        }
        
        // ë¹ˆ ìƒíƒœ í‘œì‹œ
        function showEmptyState() {
            document.getElementById('savedContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">â¤ï¸</div>
                    <h2 class="empty-title">ì•„ì§ ì €ì¥ëœ ë§›ì§‘ì´ ì—†ì–´ìš”</h2>
                    <p class="empty-desc">ë§ˆìŒì— ë“œëŠ” ë§›ì§‘ì„ ì°¾ì•„ í•˜íŠ¸ë¥¼ ëˆŒëŸ¬ ì €ì¥í•´ë³´ì„¸ìš”!</p>
                    <button class="explore-btn" onclick="goToMain()">
                        <i class="fas fa-search"></i>
                        ë§›ì§‘ ì°¾ì•„ë³´ê¸°
                    </button>
                </div>
            `;
        }
        
        // ì €ì¥ëœ ë§›ì§‘ í‘œì‹œ
        function displaySavedRestaurants() {
            const categoryEmojis = {
                'í•œì‹': 'ğŸ²',
                'í•´ì‚°ë¬¼': 'ğŸ¦',
                'ê°„ì‹': 'ğŸ¡',
                'ì¹´í˜': 'â˜•'
            };
            
            const html = `
                <div class="saved-grid">
                    ${savedRestaurants.map(restaurant => {
                        const emoji = categoryEmojis[restaurant.category] || 'ğŸ½ï¸';
                        const savedDate = restaurant.savedAt ? 
                            new Date(restaurant.savedAt).toLocaleDateString('ko-KR') : 
                            'ìµœê·¼';
                        
                        return `
                            <div class="saved-card" onclick="showRestaurantDetail('${restaurant.id}')">
                                <div class="saved-card-header">
                                    ${emoji}
                                    <button class="remove-btn" onclick="removeRestaurant(event, '${restaurant.id}')" aria-label="ì‚­ì œ">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="saved-card-body">
                                    <h3 class="saved-card-name">${restaurant.name}</h3>
                                    <div class="saved-card-info">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>${restaurant.area} Â· ${restaurant.category}</span>
                                    </div>
                                    <p class="saved-card-desc">${restaurant.description || 'ë§›ìˆëŠ” ' + restaurant.category + ' ë§›ì§‘'}</p>
                                    <div class="saved-card-footer">
                                        <span class="saved-date">ì €ì¥ì¼: ${savedDate}</span>
                                        <a href="#" class="view-detail-btn">
                                            ìì„¸íˆ ë³´ê¸°
                                            <i class="fas fa-chevron-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            document.getElementById('savedContent').innerHTML = html;
        }
        
        // ë§›ì§‘ ì‚­ì œ
        async function removeRestaurant(event, restaurantId) {
            event.stopPropagation();
            
            if (!confirm('ì´ ë§›ì§‘ì„ ì €ì¥ ëª©ë¡ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                await apiClient.unsaveRestaurant(restaurantId);
                
                // ëª©ë¡ì—ì„œ ì œê±°
                savedRestaurants = savedRestaurants.filter(r => r.id !== restaurantId);
                document.getElementById('savedCount').textContent = savedRestaurants.length;
                
                if (savedRestaurants.length === 0) {
                    showEmptyState();
                } else {
                    displaySavedRestaurants();
                }
                
                showToast('ë§›ì§‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë§›ì§‘ ì‚­ì œ ì‹¤íŒ¨:', error);
                showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ë§›ì§‘ ìƒì„¸ ë³´ê¸°
        function showRestaurantDetail(restaurantId) {
            const restaurant = savedRestaurants.find(r => r.id === restaurantId);
            if (restaurant) {
                const details = [
                    `ğŸ½ï¸ ${restaurant.name}`,
                    `ğŸ“ ${restaurant.address || restaurant.area}`,
                    `ğŸ“± ${restaurant.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'}`,
                    `â­ ${restaurant.rating || 'í‰ì  ì—†ìŒ'}`,
                    `ğŸ’° ${restaurant.price_range || 'ê°€ê²©ëŒ€ ì—†ìŒ'}`,
                    `ğŸ“ ${restaurant.description || restaurant.specialties || 'ì„¤ëª… ì—†ìŒ'}`
                ];
                
                alert(details.join('\n'));
            } else {
                alert('ë§›ì§‘ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'error' ? '#FF4757' : '#2F2F2F'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                z-index: 1000;
                animation: slideUp 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜
        function goBack() {
            window.location.href = 'index.html';
        }
        
        function goToMain() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
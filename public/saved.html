<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì €ì¥ëœ ë§›ì§‘ - ëšœê¸°</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="api-client.js"></script>
    <style>
        .saved-container {
            min-height: 100vh;
            background: #F5F5F5;
            padding: 20px;
            padding-top: 80px;
        }
        
        .saved-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #FFFFFF;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #2F2F2F;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            margin-right: 16px;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: #2F2F2F;
            flex: 1;
        }
        
        .saved-count {
            background: #FF6B35;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .saved-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 16px;
            margin-top: 40px;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            color: #2F2F2F;
            margin-bottom: 8px;
        }
        
        .empty-desc {
            color: #8E8E8E;
            margin-bottom: 24px;
        }
        
        .explore-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #FF6B35 0%, #FFD166 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .explore-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
        }
        
        /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
        .slider-container {
            position: relative;
            max-width: 600px;
            margin: 20px auto;
            padding: 60px 0;
        }
        
        .saved-slider {
            overflow: hidden;
            border-radius: 20px;
            height: 400px;
        }
        
        .slider-track {
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .slider-btn {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            font-size: 18px;
            color: #333;
        }
        
        .slider-btn:hover {
            background: #FF6B35;
            color: white;
            transform: translateX(-50%) scale(1.1);
        }
        
        .slider-btn.prev {
            top: 0;
        }
        
        .slider-btn.next {
            bottom: 0;
        }
        
        .slider-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .slider-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #E5E5E5;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dot.active {
            width: 24px;
            border-radius: 4px;
            background: #FF6B35;
        }
        
        .saved-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .saved-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }
        
        .saved-card-header {
            height: 120px;
            background: linear-gradient(135deg, #FF6B35 0%, #FFD166 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
        }
        
        .remove-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .remove-btn:hover {
            background: #FF4757;
            color: white;
            transform: scale(1.1);
        }
        
        .saved-card-body {
            padding: 20px;
        }
        
        .saved-card-name {
            font-size: 18px;
            font-weight: 700;
            color: #2F2F2F;
            margin-bottom: 8px;
        }
        
        .saved-card-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8E8E8E;
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        .saved-card-desc {
            color: #5F5F5F;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .saved-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid #E5E5E5;
        }
        
        .saved-date {
            color: #8E8E8E;
            font-size: 12px;
        }
        
        .view-detail-btn {
            color: #FF6B35;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner i {
            font-size: 32px;
            color: #FF6B35;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .slider-container {
                padding: 50px 20px;
            }
            
            .saved-slider {
                height: 350px;
            }
            
            .slider-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            
            .saved-card {
                height: 350px !important;
                min-height: 350px !important;
            }
        }
    </style>
</head>
<body>
    <div class="saved-header">
        <button class="back-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 class="header-title">ì €ì¥ëœ ë§›ì§‘</h1>
        <div class="saved-count" id="savedCount">0</div>
    </div>
    
    <div class="saved-container">
        <div class="saved-content" id="savedContent">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>ì €ì¥ëœ ë§›ì§‘ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>
    
    <script>
        let savedRestaurants = [];
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async () => {
            // ë¡œê·¸ì¸ í™•ì¸
            if (!apiClient.isLoggedIn()) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            // ì €ì¥ëœ ë§›ì§‘ ë°ì´í„° ë¡œë“œ
            await loadSavedRestaurants();
        });
        
        // ì €ì¥ëœ ë§›ì§‘ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSavedRestaurants() {
            try {
                const savedData = await apiClient.getSavedRestaurants();
                const savedIds = savedData.restaurantIds || [];
                
                document.getElementById('savedCount').textContent = savedIds.length;
                
                if (savedIds.length === 0) {
                    showEmptyState();
                } else {
                    // ì €ì¥ëœ IDë“¤ë§Œ í‘œì‹œ (ì‹¤ì œ ë°ì´í„°ëŠ” ë³„ë„ë¡œ ë¡œë“œí•˜ì§€ ì•Šê³ )
                    savedRestaurants = savedIds.map(id => ({ id: id, name: `ë§›ì§‘ ${id}` }));
                    displaySavedRestaurants();
                }
            } catch (error) {
                console.error('ì €ì¥ëœ ë§›ì§‘ ë¡œë“œ ì‹¤íŒ¨:', error);
                showEmptyState();
            }
        }
        
        // ë¹ˆ ìƒíƒœ í‘œì‹œ
        function showEmptyState() {
            document.getElementById('savedContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">â¤ï¸</div>
                    <h2 class="empty-title">ì•„ì§ ì €ì¥ëœ ë§›ì§‘ì´ ì—†ì–´ìš”</h2>
                    <p class="empty-desc">ë§ˆìŒì— ë“œëŠ” ë§›ì§‘ì„ ì°¾ì•„ í•˜íŠ¸ë¥¼ ëˆŒëŸ¬ ì €ì¥í•´ë³´ì„¸ìš”!</p>
                    <button class="explore-btn" onclick="goToMain()">
                        <i class="fas fa-search"></i>
                        ë§›ì§‘ ì°¾ì•„ë³´ê¸°
                    </button>
                </div>
            `;
        }
        
        // ìŠ¬ë¼ì´ë” ê´€ë ¨ ë³€ìˆ˜
        let currentSlide = 0;
        let totalSlides = 0;
        
        // ì €ì¥ëœ ë§›ì§‘ í‘œì‹œ (ìŠ¬ë¼ì´ë” ë°©ì‹)
        function displaySavedRestaurants() {
            const categoryEmojis = {
                'í•œì‹': 'ğŸ²',
                'í•´ì‚°ë¬¼': 'ğŸ¦',
                'ê°„ì‹': 'ğŸ¡',
                'ì¹´í˜': 'â˜•'
            };
            
            totalSlides = savedRestaurants.length;
            currentSlide = 0;
            
            const html = `
                <div class="slider-container">
                    <button class="slider-btn prev" onclick="prevSlide()" ${totalSlides <= 1 ? 'disabled' : ''}>
                        <i class="fas fa-chevron-up"></i>
                    </button>
                    <button class="slider-btn next" onclick="nextSlide()" ${totalSlides <= 1 ? 'disabled' : ''}>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    
                    <div class="saved-slider">
                        <div class="slider-track" id="sliderTrack">
                            ${savedRestaurants.map(restaurant => {
                                const emoji = categoryEmojis[restaurant.category] || 'ğŸ½ï¸';
                                const savedDate = restaurant.savedAt ? 
                                    new Date(restaurant.savedAt).toLocaleDateString('ko-KR') : 
                                    'ìµœê·¼';
                                
                                return `
                                    <div class="saved-card" style="min-height: 400px; height: 400px; flex-shrink: 0;">
                                        <div class="saved-card-header">
                                            ${emoji}
                                            <button class="remove-btn" onclick="removeRestaurant(event, '${restaurant.id}')" aria-label="ì‚­ì œ">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="saved-card-body">
                                            <h3 class="saved-card-name">${restaurant.name}</h3>
                                            <div class="saved-card-info">
                                                <i class="fas fa-map-marker-alt"></i>
                                                <span>${restaurant.area} Â· ${restaurant.category}</span>
                                            </div>
                                            <p class="saved-card-desc">${restaurant.description || 'ë§›ìˆëŠ” ' + restaurant.category + ' ë§›ì§‘'}</p>
                                            <div class="saved-card-footer">
                                                <span class="saved-date">ì €ì¥ì¼: ${savedDate}</span>
                                                <a href="#" onclick="showRestaurantDetail('${restaurant.id}'); return false;" class="view-detail-btn">
                                                    ìì„¸íˆ ë³´ê¸°
                                                    <i class="fas fa-chevron-right"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="slider-dots">
                        ${savedRestaurants.map((_, index) => `
                            <div class="dot ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('savedContent').innerHTML = html;
        }
        
        // ìŠ¬ë¼ì´ë” ì œì–´ í•¨ìˆ˜ë“¤
        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                currentSlide++;
                updateSlider();
            }
        }
        
        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                updateSlider();
            }
        }
        
        function goToSlide(index) {
            currentSlide = index;
            updateSlider();
        }
        
        function updateSlider() {
            const track = document.getElementById('sliderTrack');
            if (track) {
                track.style.transform = `translateY(-${currentSlide * 100}%)`;
                
                // ë„íŠ¸ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.dot').forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentSlide);
                });
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                const prevBtn = document.querySelector('.slider-btn.prev');
                const nextBtn = document.querySelector('.slider-btn.next');
                if (prevBtn) prevBtn.disabled = currentSlide === 0;
                if (nextBtn) nextBtn.disabled = currentSlide === totalSlides - 1;
            }
        }
        
        // ë§›ì§‘ ì‚­ì œ
        async function removeRestaurant(event, restaurantId) {
            event.stopPropagation();
            
            if (!confirm('ì´ ë§›ì§‘ì„ ì €ì¥ ëª©ë¡ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                await apiClient.unsaveRestaurant(restaurantId);
                
                // ëª©ë¡ì—ì„œ ì œê±°
                savedRestaurants = savedRestaurants.filter(r => r.id !== restaurantId);
                document.getElementById('savedCount').textContent = savedRestaurants.length;
                
                if (savedRestaurants.length === 0) {
                    showEmptyState();
                } else {
                    displaySavedRestaurants();
                }
                
                showToast('ë§›ì§‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë§›ì§‘ ì‚­ì œ ì‹¤íŒ¨:', error);
                showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ë§›ì§‘ ìƒì„¸ ë³´ê¸°
        function showRestaurantDetail(restaurantId) {
            const restaurant = savedRestaurants.find(r => r.id === restaurantId);
            if (restaurant) {
                alert(`${restaurant.name}\n${restaurant.address || restaurant.area}\n${restaurant.phone || ''}\n${restaurant.description || ''}`);
            }
        }
        
        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'error' ? '#FF4757' : '#2F2F2F'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                z-index: 1000;
                animation: slideUp 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜
        function goBack() {
            window.location.href = 'index.html';
        }
        
        function goToMain() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>